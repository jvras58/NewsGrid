# ğŸ§ª Testes do NewsGrid

Este documento descreve a estrutura e o funcionamento dos testes automatizados do projeto NewsGrid, utilizando pytest e uv.

## ğŸ“‹ IntroduÃ§Ã£o

Os testes garantem a qualidade e a integridade do cÃ³digo, verificando funcionalidades como criaÃ§Ã£o de agentes, processamento de mensagens via RabbitMQ, geraÃ§Ã£o de relatÃ³rios e anÃ¡lise de tÃ³picos. Eles sÃ£o executados com pytest, integrado ao uv para gerenciamento de dependÃªncias.

## ğŸ—ï¸ Estrutura dos Testes

Os testes estÃ£o organizados no diretÃ³rio `tests/`:

- **`conftest.py`**: âš™ï¸ ConfiguraÃ§Ãµes compartilhadas, como fixtures para setup de testes.
- **`test_analyze.py`**: ğŸ” Testa a API de anÃ¡lise de tÃ³picos.
- **`test_create_agents.py`**: ğŸ¤– Testa a criaÃ§Ã£o e inicializaÃ§Ã£o de agentes (ResearchAgent e AnalystAgent).
- **`test_report.py`**: ğŸ“„ Testa a geraÃ§Ã£o e salvamento de relatÃ³rios em Markdown.
- **`test_rabbitmq_connection.py`**: ğŸ° Testa a conexÃ£o e processamento de mensagens via RabbitMQ para workers.
- **`test_send_to_queue.py`**: ğŸ“¨ Testa o envio de mensagens para filas RabbitMQ.
- **`test_workers.py`**: ğŸ‘· Testa o funcionamento geral dos workers (pesquisa e anÃ¡lise).

Cada arquivo foca em componentes especÃ­ficos, usando mocks para isolar dependÃªncias externas (como conexÃµes RabbitMQ ou APIs externas).

## â–¶ï¸ Como Executar os Testes

### ğŸ“‹ PrÃ©-requisitos
- Ambiente virtual ativado com `uv`.
- DependÃªncias instaladas via `uv sync --group dev` (para incluir ferramentas de teste como pytest).

### ğŸš€ Comandos BÃ¡sicos

- **Executar todos os testes**:
  ```
  uv run pytest
  ```

- **Executar testes de um arquivo especÃ­fico**:
  ```
  uv run pytest tests/test_analyze.py
  ```

- **Executar um teste individual**:
  ```
  uv run pytest tests/test_analyze.py::test_request_analysis_success
  ```
  Substitua `test_request_analysis_success` pelo nome do teste desejado.

- **Executar testes com cobertura de cÃ³digo** (se `pytest-cov` estiver instalado):
  ```
  uv run pytest --cov=app --cov-report=html
  ```
  Isso gera um relatÃ³rio HTML em `htmlcov/index.html`.

- **Executar testes em modo verbose** (mais detalhes):
  ```
  uv run pytest -v
  ```

- **Executar testes com saÃ­da de logs**:
  ```
  uv run pytest --log-cli-level=INFO
  ```

Para mais opÃ§Ãµes, consulte `uv run pytest --help`.

## ğŸ› ï¸ Ferramentas e DependÃªncias

- **pytest**: ğŸ§ª Framework de testes, configurado em `pyproject.toml` com plugins como `pytest-asyncio` e `pytest-cov`.
- **uv**: ğŸ“¦ Gerenciador de pacotes e execuÃ§Ã£o de comandos.
- **unittest.mock**: ğŸ­ Para mocks e patches em testes.
- **pytest-cov** (opcional): ğŸ“Š Para geraÃ§Ã£o de relatÃ³rios de cobertura.

## â• Adicionando Novos Testes

1. ğŸ“ Crie um novo arquivo em `tests/` seguindo o padrÃ£o `test_*.py`.
2. ğŸ”— Use fixtures de `conftest.py` se aplicÃ¡vel.
3. âœï¸ Escreva testes usando `def test_*()` ou `async def test_*()` para assÃ­ncronos.
4. ğŸ­ Use mocks para dependÃªncias externas (ex.: `@patch` para funÃ§Ãµes de conexÃ£o).
5. âœ… Execute os testes para validar.

Exemplo de teste simples:
```python
from utils.reporting import save_report

def test_save_report(tmp_path):
    # Teste de salvamento de relatÃ³rio
    pass
```

## ğŸ“Š Cobertura de CÃ³digo

A cobertura mede quantas linhas do cÃ³digo sÃ£o executadas pelos testes. Execute com `--cov=app` para ver estatÃ­sticas. RelatÃ³rios HTML ajudam a identificar Ã¡reas nÃ£o testadas.

## ğŸ’¡ Dicas e Boas PrÃ¡ticas

- âœ… Execute testes antes de commits para evitar regressÃµes.
- ğŸ­ Use mocks para testes unitÃ¡rios, evitando dependÃªncias reais.
- âš¡ Mantenha testes isolados e rÃ¡pidos.
- ğŸ³ Para testes de integraÃ§Ã£o, considere Docker para RabbitMQ.
- ğŸ” Verifique logs em caso de falhas para depuraÃ§Ã£o.
